<!DOCTYPE html>
<html>
<head>
<style>
body {
	font-family:"Consolas";
	text-align:center;
}

.red {
	color:red;
}

.blue {
	color:blue;
}
</style>
</head>
<body onload="start(false)">
<h1>FDTD Simulation</h1>
<canvas id="myChart" width="800" height="600" style="border:1px solid black"></canvas>
<br/>
<button onclick="start(false)">(Re)start</button>
<button onclick="stop()">Stop</button>
<button onclick="start(true)">Resume</button>
<button onclick="step()">Step</button>
<p>
In the animation above you can see a FDTD (finite difference time domain) simulation.<br/>
The <span class="red">electric</span> and <span class="blue">magnetic</span> field are displayed.<br/>
The y-axis represents the magnitude of the field at space x and the x-axis the space.<br/>
The simulation uses two additive source nodes. Both are at x=100 and of type gaussians.<br/>
Their peaks can be observed at t=30 and t=80.
</p>
<h2>PEC and PMC Boundary</h2>
<p>
On the right side of the simulation-space is a magnetic field, which is always zero.<br/>
Because of that, the node acts as a PMC (perfect magnetic conductor).<br/>
The PMC reflects the wave and inverts the magnetic field, while not inverting the electric field.<br/><br/>
The node on the far left acts as a PEC (perfect electric conductor),<br/>because the electric field is always zero there.<br/>
This node reflects the wave aswell and changes the sign of the electric field,<br/>while preserving that of the magnetic field.
</p>
<script type="text/javascript">
var can = document.getElementById("myChart");
var ctx = can.getContext("2d");
ctx.font = "20px Consolas";
var hw = can.width * 0.5;

var SIZE = 200;
var ez = [];
var hy = [];
function resetFields(){
	for(var i = 0; i < SIZE; i++){
		ez[i] = hy[i] = 0.0;
	}
}
resetFields();
var imp0 = 377.0;
var inv_imp0 = 1.0 / imp0;
var maxTime = 450;
var time = 0;

var dt = 10.0
var dx = can.width / (SIZE-1);
var dy = can.height * 0.5;
var timeStepID;

function source(x, t){
	return Math.exp(-(t-30.0)*(t-30.0)/100.0) - Math.exp(-(time-80.0)*(time-80.0) / 100.0);
}

function runTimeStep(){
	// update magnetic field
	for(var i = 0; i < SIZE - 1; i++){
		hy[i] += (ez[i+1] - ez[i]) * inv_imp0;
	}
	// update electric field
	for(var i = 1; i < SIZE; i++){
		ez[i] += (hy[i] - hy[i-1]) * imp0;
	}
	// additive source node
	ez[100] += source(100, time);
	
	ctx.clearRect(0, 0, can.width, can.height);
	ctx.fillStyle = 'black';
	ctx.fillText("timestep: " + time, 5, 20);
	
	ctx.strokeStyle = '#aaa';
	ctx.beginPath();
	ctx.moveTo(0, dy);
	ctx.lineTo(can.width, dy);
	ctx.closePath();
	ctx.stroke();
	
	// plot electric field
	ctx.strokeStyle = 'red';
	ctx.beginPath();
	for(var i = 0; i < SIZE - 1; i++){
		ctx.moveTo(dx * i, dy - ez[i]*0.9 * dy);
		ctx.lineTo(dx * (i + 1), dy - ez[i + 1]*0.9 * dy);
	}
	ctx.closePath();
	ctx.stroke();
	
	// plot magnetic field
	ctx.strokeStyle = 'blue';
	ctx.beginPath();
	for(var i = 0; i < SIZE - 1; i++){
		ctx.moveTo(dx * i, dy - hy[i]*100.0 * dy);
		ctx.lineTo(dx * (i + 1), dy - hy[i + 1]*100.0 * dy);
	}
	ctx.closePath();
	ctx.stroke();	
	time++;
}

function start(resume){
	if (!resume){
		time = 0;
		resetFields();
	}
	stop();
	timeStepID = setInterval(runTimeStep, 50);
}
function stop(){
	if (timeStepID){
		clearInterval(timeStepID);
		timeStepID = null;
	}
}
function step(){
	if (timeStepID)
		return;
	runTimeStep();
}
</script>
</body>
</html>
